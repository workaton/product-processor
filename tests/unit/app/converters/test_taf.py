from contextlib import ExitStack
from unittest.mock import patch
from uuid import UUID
import xml.etree.ElementTree as etree  # noqa: N813 -- for lxml compatibility

from app.converters import ConversionInput, TafCollectiveConverter
from app.media_types import MediaTypes
import pendulum
import pytest
from tests.conftest import compare_xml
import time_machine


class TestTafCollectiveConverter:

    @pytest.mark.skip(reason="this test is broken and needs to be fixed")
    @pytest.mark.asyncio
    async def test_convert(self, obs_locator):
        converter = TafCollectiveConverter(obs_locator)
        with ExitStack() as stack:
            stack.enter_context(time_machine.travel(pendulum.parse('2020-07-23T15:09:21Z')))
            stack.enter_context(patch('uuid.uuid4', return_value=UUID('a36a2138-2c09-473e-bd0d-916531537b02')))
            results = await converter.convert([ConversionInput(TAC, MediaTypes.TEXT_PLAIN)])

        assert len(results) == 1
        xml_tree = etree.fromstring(XML)
        result = results[0]
        assert len(result.data) > 0
        result_tree = etree.fromstring(result.data)
        assert compare_xml(xml_tree, result_tree)

    @pytest.mark.asyncio
    async def test_convert_for_xml_input(self, obs_locator):
        converter = TafCollectiveConverter(obs_locator)
        results = await converter.convert([ConversionInput(XML, MediaTypes.APPLICATION_IWXXM_XML)])

        assert len(results) == 1
        xml_tree = etree.fromstring(XML)
        result = results[0]
        assert len(result.data) > 0
        assert result.media_type == MediaTypes.APPLICATION_IWXXM_XML
        result_tree = etree.fromstring(result.data)
        assert compare_xml(xml_tree, result_tree)


TAC = b'''\
\r\r\n
000\r\r\n
FTUS90 KWBC 140427 AAA\r\r\n
TAF AMD PAHN 140424Z 1404/1424 10008KT P6SM -RA FEW025 OVC050\n
     FM140900 08007KT 6SM -RA OVC025\n
     FM142100 07005KT P6SM -SHRA SCT015 OVC025 AMD LTD TO CLD VIS\n
     AND WIND=\n
TAF AMD KGLD 140424Z 1404/1424 10009G22KT 3SM TSRA BR FEW005\r\r\n
     BKN024 OVC045CB\r\r\n
     FM140500 18014KT P6SM BKN200\r\r\n
     FM140800 18006KT P6SM SCT250\r\r\n
     FM141500 01010KT P6SM BKN200\r\r\n
     FM141700 04010KT P6SM BKN070=\r\r\n
TAF AMD KMCK 140425Z 1404/1424 03021G29KT 6SM -TSRA BR BKN012\r\r\n
     BKN090 BKN120CB\r\r\n
     FM140600 13008KT P6SM VCTS BKN200CB\r\r\n
     FM141000 06005KT P6SM SCT250 WS020/19030KT\r\r\n
     FM141500 02014KT P6SM BKN015=\r\r\n
TAF AMD PAJN 140425Z 1404/1424 12012KT P6SM -RA FEW025 OVC050\r\r\n
     TEMPO 1404/1408 12012G22KT 6SM -RA BR BKN025 OVC050\r\r\n
     FM140800 10012KT 5SM -RA BR SCT015 OVC025\r\r\n
     FM141100 10015KT 4SM -RA BR BKN015 OVC025 WS020/14030KT\r\r\n
     FM141700 10012KT 4SM -RA BR BKN015 OVC025\r\r\n
     FM142000 11012KT 6SM -SHRA BR SCT015 OVC025=\r\r\n
TAF AMD KMCK 140425Z 1404/1424 09013G17KT P6SM FEW070 BKN110\r\r\n
     FM140600 13008KT P6SM VCTS BKN200CB\r\r\n
     FM141000 06005KT P6SM SCT250 WS020/19030KT\r\r\n
     FM141500 02014KT P6SM BKN015=\r\r\n
TAF AMD KPVW 140426Z 1404/1424 VRB08KT P6SM VCTS SCT110CB SCT160\r\r\n
     SCT250 TEMPO 1404/1406 28020G45KT -TSRA SCT070CB\r\r\n
     FM140700 21009KT P6SM BKN160\r\r\n
     FM140800 22011KT P6SM SCT110=\r\r\n
\r\r\n
'''  # noqa: E501

XML = b'''\
<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<MeteorologicalBulletin xmlns="http://def.wmo.int/collect/2014" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://def.wmo.int/collect/2014 http://schemas.wmo.int/collect/1.2/collect.xsd" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" translationFailedTAC="TAF AMD PAHN 140424Z 1404/1424 10008KT P6SM -RA FEW025 OVC050&#13;&#13;&#10;&#10;     FM140900 08007KT 6SM -RA OVC025&#13;&#13;&#10;&#10;     FM142100 07005KT P6SM -SHRA SCT015 OVC025 AMD LTD TO CLD VIS&#13;&#13;&#10;&#10;     AND WIND=" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:24:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>PAHN</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>PAHN</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod></iwxxm:TAF></meteorologicalInformation><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:24:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>KGLD</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>KGLD</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod><iwxxm:baseForecast><iwxxm:MeteorologicalAerodromeForecast cloudAndVisibilityOK="false" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:phenomenonTime xlink:href="#uuid.a36a2138-2c09-473e-bd0d-916531537b02" /><iwxxm:prevailingVisibility uom="m">4800</iwxxm:prevailingVisibility><iwxxm:surfaceWind><iwxxm:AerodromeSurfaceWindForecast variableWindDirection="false"><iwxxm:meanWindDirection uom="deg">100</iwxxm:meanWindDirection><iwxxm:meanWindSpeed uom="[kn_i]">9</iwxxm:meanWindSpeed><iwxxm:windGustSpeed uom="[kn_i]">22</iwxxm:windGustSpeed></iwxxm:AerodromeSurfaceWindForecast></iwxxm:surfaceWind><iwxxm:weather xlink:href="http://codes.wmo.int/306/4678/TSRA" /><iwxxm:weather xlink:href="http://codes.wmo.int/306/4678/BR" /><iwxxm:cloud><iwxxm:AerodromeCloudForecast gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/FEW" /><iwxxm:base uom="[ft_i]">500</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/BKN" /><iwxxm:base uom="[ft_i]">2400</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/OVC" /><iwxxm:base uom="[ft_i]">4500</iwxxm:base><iwxxm:cloudType xlink:href="http://codes.wmo.int/49-2/SigConvectiveCloudType/CB" /></iwxxm:CloudLayer></iwxxm:layer></iwxxm:AerodromeCloudForecast></iwxxm:cloud></iwxxm:MeteorologicalAerodromeForecast></iwxxm:baseForecast><iwxxm:changeForecast><iwxxm:MeteorologicalAerodromeForecast cloudAndVisibilityOK="false" changeIndicator="FROM" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:phenomenonTime><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T05:00:00Z</gml:beginPosition><gml:endPosition>2020-07-14T08:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:phenomenonTime><iwxxm:prevailingVisibility uom="m">10000</iwxxm:prevailingVisibility><iwxxm:prevailingVisibilityOperator>ABOVE</iwxxm:prevailingVisibilityOperator><iwxxm:surfaceWind><iwxxm:AerodromeSurfaceWindForecast variableWindDirection="false"><iwxxm:meanWindDirection uom="deg">180</iwxxm:meanWindDirection><iwxxm:meanWindSpeed uom="[kn_i]">14</iwxxm:meanWindSpeed></iwxxm:AerodromeSurfaceWindForecast></iwxxm:surfaceWind><iwxxm:cloud><iwxxm:AerodromeCloudForecast gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/BKN" /><iwxxm:base uom="[ft_i]">20000</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer></iwxxm:AerodromeCloudForecast></iwxxm:cloud></iwxxm:MeteorologicalAerodromeForecast></iwxxm:changeForecast><iwxxm:changeForecast><iwxxm:MeteorologicalAerodromeForecast cloudAndVisibilityOK="false" changeIndicator="FROM" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:phenomenonTime><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T08:00:00Z</gml:beginPosition><gml:endPosition>2020-07-14T15:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:phenomenonTime><iwxxm:prevailingVisibility uom="m">10000</iwxxm:prevailingVisibility><iwxxm:prevailingVisibilityOperator>ABOVE</iwxxm:prevailingVisibilityOperator><iwxxm:surfaceWind><iwxxm:AerodromeSurfaceWindForecast variableWindDirection="false"><iwxxm:meanWindDirection uom="deg">180</iwxxm:meanWindDirection><iwxxm:meanWindSpeed uom="[kn_i]">6</iwxxm:meanWindSpeed></iwxxm:AerodromeSurfaceWindForecast></iwxxm:surfaceWind><iwxxm:cloud><iwxxm:AerodromeCloudForecast gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/SCT" /><iwxxm:base uom="[ft_i]">25000</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer></iwxxm:AerodromeCloudForecast></iwxxm:cloud></iwxxm:MeteorologicalAerodromeForecast></iwxxm:changeForecast><iwxxm:changeForecast><iwxxm:MeteorologicalAerodromeForecast cloudAndVisibilityOK="false" changeIndicator="FROM" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:phenomenonTime><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T15:00:00Z</gml:beginPosition><gml:endPosition>2020-07-14T17:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:phenomenonTime><iwxxm:prevailingVisibility uom="m">10000</iwxxm:prevailingVisibility><iwxxm:prevailingVisibilityOperator>ABOVE</iwxxm:prevailingVisibilityOperator><iwxxm:surfaceWind><iwxxm:AerodromeSurfaceWindForecast variableWindDirection="false"><iwxxm:meanWindDirection uom="deg">10</iwxxm:meanWindDirection><iwxxm:meanWindSpeed uom="[kn_i]">10</iwxxm:meanWindSpeed></iwxxm:AerodromeSurfaceWindForecast></iwxxm:surfaceWind><iwxxm:cloud><iwxxm:AerodromeCloudForecast gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/BKN" /><iwxxm:base uom="[ft_i]">20000</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer></iwxxm:AerodromeCloudForecast></iwxxm:cloud></iwxxm:MeteorologicalAerodromeForecast></iwxxm:changeForecast><iwxxm:changeForecast><iwxxm:MeteorologicalAerodromeForecast cloudAndVisibilityOK="false" changeIndicator="FROM" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:phenomenonTime><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T17:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:phenomenonTime><iwxxm:prevailingVisibility uom="m">10000</iwxxm:prevailingVisibility><iwxxm:prevailingVisibilityOperator>ABOVE</iwxxm:prevailingVisibilityOperator><iwxxm:surfaceWind><iwxxm:AerodromeSurfaceWindForecast variableWindDirection="false"><iwxxm:meanWindDirection uom="deg">40</iwxxm:meanWindDirection><iwxxm:meanWindSpeed uom="[kn_i]">10</iwxxm:meanWindSpeed></iwxxm:AerodromeSurfaceWindForecast></iwxxm:surfaceWind><iwxxm:cloud><iwxxm:AerodromeCloudForecast gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:layer><iwxxm:CloudLayer><iwxxm:amount xlink:href="http://codes.wmo.int/49-2/CloudAmountReportedAtAerodrome/BKN" /><iwxxm:base uom="[ft_i]">7000</iwxxm:base></iwxxm:CloudLayer></iwxxm:layer></iwxxm:AerodromeCloudForecast></iwxxm:cloud></iwxxm:MeteorologicalAerodromeForecast></iwxxm:changeForecast></iwxxm:TAF></meteorologicalInformation><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" translationFailedTAC="TAF AMD KMCK 140425Z 1404/1424 03021G29KT 6SM -TSRA BR BKN012&#13;&#13;&#10;&#10;     BKN090 BKN120CB&#13;&#13;&#10;&#10;     FM140600 13008KT P6SM VCTS BKN200CB&#13;&#13;&#10;&#10;     FM141000 06005KT P6SM SCT250 WS020/19030KT&#13;&#13;&#10;&#10;     FM141500 02014KT P6SM BKN015=" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:25:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>KMCK</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>KMCK</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod></iwxxm:TAF></meteorologicalInformation><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" translationFailedTAC="TAF AMD PAJN 140425Z 1404/1424 12012KT P6SM -RA FEW025 OVC050&#13;&#13;&#10;&#10;     TEMPO 1404/1408 12012G22KT 6SM -RA BR BKN025 OVC050&#13;&#13;&#10;&#10;     FM140800 10012KT 5SM -RA BR SCT015 OVC025&#13;&#13;&#10;&#10;     FM141100 10015KT 4SM -RA BR BKN015 OVC025 WS020/14030KT&#13;&#13;&#10;&#10;     FM141700 10012KT 4SM -RA BR BKN015 OVC025&#13;&#13;&#10;&#10;     FM142000 11012KT 6SM -SHRA BR SCT015 OVC025=" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:25:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>PAJN</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>PAJN</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod></iwxxm:TAF></meteorologicalInformation><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" translationFailedTAC="TAF AMD KMCK 140425Z 1404/1424 09013G17KT P6SM FEW070 BKN110&#13;&#13;&#10;&#10;     FM140600 13008KT P6SM VCTS BKN200CB&#13;&#13;&#10;&#10;     FM141000 06005KT P6SM SCT250 WS020/19030KT&#13;&#13;&#10;&#10;     FM141500 02014KT P6SM BKN015=" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:25:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>KMCK</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>KMCK</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod></iwxxm:TAF></meteorologicalInformation><meteorologicalInformation><iwxxm:TAF xmlns:aixm="http://www.aixm.aero/schema/5.1.1" xmlns:iwxxm="http://icao.int/iwxxm/3.0" xmlns:gml="http://www.opengis.net/gml/3.2" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://icao.int/iwxxm/3.0 http://schemas.wmo.int/iwxxm/3.0/iwxxm.xsd" reportStatus="AMENDMENT" permissibleUsage="OPERATIONAL" translationCentreName="NCEP Central Operations" translationCentreDesignator="KWNO" translationTime="2020-07-23T15:09:21Z" translatedBulletinReceptionTime="2020-07-23T15:09:21Z" translatedBulletinID="FTUS90KWBC140427AAA" translationFailedTAC="TAF AMD KPVW 140426Z 1404/1424 VRB08KT P6SM VCTS SCT110CB SCT160&#13;&#13;&#10;&#10;     SCT250 TEMPO 1404/1406 28020G45KT -TSRA SCT070CB&#13;&#13;&#10;&#10;     FM140700 21009KT P6SM BKN160&#13;&#13;&#10;&#10;     FM140800 22011KT P6SM SCT110=" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><iwxxm:issueTime><gml:TimeInstant gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:timePosition>2020-07-14T04:26:00Z</gml:timePosition></gml:TimeInstant></iwxxm:issueTime><iwxxm:aerodrome><aixm:AirportHeliport gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><aixm:timeSlice><aixm:AirportHeliportTimeSlice gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:validTime /><aixm:interpretation>SNAPSHOT</aixm:interpretation><aixm:designator>KPVW</aixm:designator><aixm:name>TEST STATION</aixm:name><aixm:locationIndicatorICAO>KPVW</aixm:locationIndicatorICAO><aixm:ARP><aixm:ElevatedPoint srsDimension="2" srsName="http://www.opengis.net/def/crs/EPSG/0/4326" axisLabels="Lat Long" gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:pos>0.0 0.0</gml:pos></aixm:ElevatedPoint></aixm:ARP></aixm:AirportHeliportTimeSlice></aixm:timeSlice></aixm:AirportHeliport></iwxxm:aerodrome><iwxxm:validPeriod><gml:TimePeriod gml:id="uuid.a36a2138-2c09-473e-bd0d-916531537b02"><gml:beginPosition>2020-07-14T04:00:00Z</gml:beginPosition><gml:endPosition>2020-07-15T00:00:00Z</gml:endPosition></gml:TimePeriod></iwxxm:validPeriod></iwxxm:TAF></meteorologicalInformation><bulletinIdentifier>A_LTUS90KWBC140427AAA_C_KWBC_20200723150921.xml</bulletinIdentifier></MeteorologicalBulletin>
'''  # noqa: E501
